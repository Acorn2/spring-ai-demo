å¥½ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ç»™ä½ ä¸€å¥—**ã€Œä¼ä¸šçº§å¯è½åœ°çš„çŸ¥è¯†åº“é—®ç­”ï¼ˆRAGï¼‰å®Œæ•´ç¤ºä¾‹ã€**ï¼Œä¸æ˜¯ç©å…· Demoï¼Œè€Œæ˜¯**ä½ æ‹¿å»å°±èƒ½æ”¾è¿›çœŸå®ç³»ç»Ÿçš„é‚£ç§**ã€‚
æˆ‘ä¼š**æŒ‰å·¥ç¨‹è§†è§’æ¥è®²**ï¼Œé¿å…â€œAI è¯¾ç¨‹å¼åºŸè¯â€ã€‚

> æŠ€æœ¯åŸºçº¿å‡è®¾ï¼š
>
> * ä½ ç†Ÿ Spring Boot / å¹¶å‘ / æ¶æ„
> * å¯æ¥å— OpenAI æˆ– Ollamaï¼ˆæˆ‘ä¸¤å¥—éƒ½ä¼šç»™ï¼‰

---

# ä¸€ã€ç›®æ ‡å®šä¹‰ï¼ˆå…ˆå¯¹é½ï¼‰

### ğŸ¯ æˆ‘ä»¬è¦åšçš„æ˜¯ä»€ä¹ˆï¼Ÿ

> ä¸€ä¸ª REST æ¥å£ï¼š
> **è¾“å…¥é—®é¢˜ â†’ åŸºäºä¼ä¸šå†…éƒ¨æ–‡æ¡£ â†’ ç»™å‡ºå¯ä¿¡ç­”æ¡ˆ**

å…³é”®èƒ½åŠ›ï¼š

* æ–‡æ¡£å…¥åº“ï¼ˆPDF / Word / Markdownï¼‰
* å‘é‡åŒ–ï¼ˆEmbeddingï¼‰
* ç›¸ä¼¼åº¦æ£€ç´¢
* åŸºäºæ£€ç´¢ç»“æœè¿›è¡Œå›ç­”ï¼ˆRAGï¼‰

**éç›®æ ‡ï¼ˆæš‚ä¸åšï¼‰**

* èŠå¤©è®°å¿†
* Agent å¤šè½®è§„åˆ’
* è‡ªåŠ¨çˆ¬è™«

---

# äºŒã€æ•´ä½“æ¶æ„ï¼ˆå·¥ç¨‹è§†è§’ï¼‰

```
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  æ–‡æ¡£æº   â”‚
            â”‚ PDF/MD   â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
          æ–‡æ¡£è§£æ & åˆ‡åˆ†
                 â”‚
            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
            â”‚ Embeddingâ”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Vector Store   â”‚
          â”‚ (PG / Redis)  â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          ç›¸ä¼¼åº¦æ£€ç´¢ (TopK)
                 â”‚
            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
            â”‚   LLM    â”‚
            â”‚  Prompt  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ‘‰ **ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆï¼š**

> ä¸€ä¸ªâ€œ**å¸¦ç´¢å¼•çš„å…¨æ–‡æœç´¢ + AI æ€»ç»“å±‚**â€

---

# ä¸‰ã€æŠ€æœ¯é€‰å‹ï¼ˆç¨³å¦¥ç‰ˆï¼‰

| æ¨¡å—          | é€‰å‹                      |
| ----------- | ----------------------- |
| LLM         | OpenAI / Ollama         |
| Embedding   | text-embedding-3-small  |
| VectorStore | PostgreSQL (pgvector)   |
| æ¡†æ¶          | Spring Boot + Spring AI |

---

# å››ã€é¡¹ç›®ç»“æ„ï¼ˆé‡ç‚¹ï¼‰

```text
knowledge-qa
â”œâ”€â”€ controller
â”‚   â””â”€â”€ KnowledgeQaController.java
â”œâ”€â”€ service
â”‚   â”œâ”€â”€ DocumentIngestService.java
â”‚   â”œâ”€â”€ KnowledgeQaService.java
â”‚   â””â”€â”€ PromptBuilder.java
â”œâ”€â”€ store
â”‚   â””â”€â”€ VectorStoreConfig.java
â”œâ”€â”€ toolï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ domain
â”‚   â””â”€â”€ DocumentChunk.java
â””â”€â”€ resources
    â””â”€â”€ docs/
```

---

# äº”ã€æ ¸å¿ƒæ­¥éª¤ 1ï¼šå‘é‡åº“é…ç½®ï¼ˆpgvectorï¼‰

## 1ï¸âƒ£ PostgreSQL è¡¨ç»“æ„

```sql
CREATE TABLE knowledge_vector (
    id BIGSERIAL PRIMARY KEY,
    content TEXT,
    embedding VECTOR(1536),
    metadata JSONB
);
```

---

## 2ï¸âƒ£ Spring AI VectorStore é…ç½®

```java
@Configuration
public class VectorStoreConfig {

    @Bean
    public PgVectorStore vectorStore(
            JdbcTemplate jdbcTemplate,
            EmbeddingModel embeddingModel) {

        return new PgVectorStore(
                jdbcTemplate,
                embeddingModel,
                "knowledge_vector",
                "embedding",
                "content",
                "metadata"
        );
    }
}
```

---

# å…­ã€æ ¸å¿ƒæ­¥éª¤ 2ï¼šæ–‡æ¡£å…¥åº“ï¼ˆIngestï¼‰

### 1ï¸âƒ£ æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥ï¼ˆå¾ˆå…³é”®ï¼‰

> âŒ ä¸è¦ä¸€æ•´ç¯‡
> âœ… 300ï½500 tokens ä¸€æ®µ
> æœ‰ overlapï¼ˆä¸Šä¸‹æ–‡ï¼‰

```java
@Service
@RequiredArgsConstructor
public class DocumentIngestService {

    private final VectorStore vectorStore;

    public void ingest(String text, String source) {

        List<Document> documents =
                new TokenTextSplitter(400, 50)
                        .apply(List.of(
                                new Document(text, Map.of("source", source))
                        ));

        vectorStore.add(documents);
    }
}
```

---

### 2ï¸âƒ£ è°ƒç”¨ç¤ºä¾‹

```java
@PostConstruct
public void init() {
    ingestService.ingest(
        Files.readString(Path.of("docs/company-rule.md")),
        "company-rule"
    );
}
```

---

# ä¸ƒã€æ ¸å¿ƒæ­¥éª¤ 3ï¼šçŸ¥è¯†é—®ç­”ï¼ˆRAGï¼‰

## 1ï¸âƒ£ æ£€ç´¢ TopK

```java
@Service
@RequiredArgsConstructor
public class KnowledgeQaService {

    private final VectorStore vectorStore;
    private final ChatModel chatModel;
    private final PromptBuilder promptBuilder;

    public String ask(String question) {

        List<Document> docs = vectorStore.similaritySearch(
                SearchRequest.query(question).withTopK(4)
        );

        Prompt prompt = promptBuilder.build(question, docs);

        return chatModel
                .call(prompt)
                .getResult()
                .getOutput()
                .getContent();
    }
}
```

---

## 2ï¸âƒ£ Prompt æ„é€ ï¼ˆå†³å®š 80% æ•ˆæœï¼‰

```java
@Component
public class PromptBuilder {

    public Prompt build(String question, List<Document> docs) {

        String context = docs.stream()
                .map(Document::getContent)
                .collect(Collectors.joining("\n---\n"));

        String template = """
        ä½ æ˜¯å…¬å¸å†…éƒ¨çŸ¥è¯†åº“åŠ©æ‰‹ã€‚
        åªèƒ½åŸºäºä»¥ä¸‹èµ„æ–™å›ç­”é—®é¢˜ï¼Œå¦‚æœèµ„æ–™ä¸­æ²¡æœ‰ç­”æ¡ˆï¼Œè¯·å›ç­”â€œæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯â€ã€‚

        ã€èµ„æ–™ã€‘
        %s

        ã€é—®é¢˜ã€‘
        %s
        """;

        return new Prompt(String.format(template, context, question));
    }
}
```

---

# å…«ã€Controller å±‚

```java
@RestController
@RequiredArgsConstructor
public class KnowledgeQaController {

    private final KnowledgeQaService qaService;

    @GetMapping("/knowledge/ask")
    public String ask(@RequestParam String q) {
        return qaService.ask(q);
    }
}
```

---

# ä¹ã€å®é™…è°ƒç”¨æ•ˆæœ

### æ–‡æ¡£å†…å®¹ï¼š

> â€œå…¬å¸æŠ¥é”€æ ‡å‡†ï¼š
> é¤é¥®ä¸è¶…è¿‡ 100 å…ƒ / äºº / å¤©â€

### è¯·æ±‚ï¼š

```
GET /knowledge/ask?q=é¤é¥®æŠ¥é”€æ ‡å‡†æ˜¯å¤šå°‘
```

### è¿”å›ï¼š

```
å…¬å¸é¤é¥®æŠ¥é”€æ ‡å‡†ä¸ºæ¯äººæ¯å¤©ä¸è¶…è¿‡100å…ƒã€‚
```

---

# åã€å·¥ç¨‹çº§å…³é”®ç‚¹ï¼ˆä½ ä¸€å®šå…³å¿ƒï¼‰

## 1ï¸âƒ£ å¹¶å‘ä¸æ€§èƒ½

* Embeddingï¼š**åªåœ¨å…¥åº“æ—¶**
* æŸ¥è¯¢é˜¶æ®µï¼šå‘é‡æœç´¢ + 1 æ¬¡ LLM
* QPS â‰ˆ æ•°æ®åº“ + LLM RTT

ğŸ‘‰ **å‘é‡åº“ä¸è¦æ”¾åœ¨ä¸»åº“**

---

## 2ï¸âƒ£ é˜²æ­¢å¹»è§‰ï¼ˆéå¸¸é‡è¦ï¼‰

* Prompt å¼ºçº¦æŸ
* TopK â‰¤ 5
* æ˜ç¡®â€œæ— ç­”æ¡ˆåˆ™æ‹’ç­”â€

---

## 3ï¸âƒ£ æˆæœ¬æ§åˆ¶

* Embedding å¤ç”¨
* é—®é¢˜é•¿åº¦è£å‰ª
* åŒç±»é—®é¢˜ç¼“å­˜ï¼ˆRedisï¼‰

---

# åä¸€ã€å¯é€‰å¢å¼ºï¼ˆä¼ä¸šçº§ï¼‰

ä½ ä¸‹ä¸€æ­¥å¯ä»¥ç›´æ¥æ‰©å±•ğŸ‘‡

### ğŸ”¹ æ–‡æ¡£æƒé™

* metadata å­˜ dept / role
* æ£€ç´¢æ—¶åŠ  filter

### ğŸ”¹ SSE æµå¼è¾“å‡º

* ChatModel Streaming
* å‰ç«¯ä½“éªŒç›´æ¥æ‹‰æ»¡

### ğŸ”¹ å¤šæ¨¡å‹

* æŸ¥è¯¢ç”¨ cheap model
* æ±‡æ€»ç”¨ strong model

---
